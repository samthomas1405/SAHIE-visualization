<!-- Updated HTML for SAHIE Visualization -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SAHIE Map Visualization</title>
  <link rel="stylesheet" href="styles.css"/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
</head>
<body>
  <div id="sidebar">
    <h1>SAHIE Map Visualization</h1>
    <!-- Global Search Bar -->
    <div id="globalSearch" class="searchbar-container">
      <label for="searchInput" id="searchLabel" class="sr-only">Search State or County</label>
      <div class="searchbar">
        <svg class="search-icon" viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
          <path d="M15.5 15.5L21 21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <circle cx="10" cy="10" r="6" stroke="currentColor" stroke-width="2" fill="none"/>
        </svg>
        <input type="text" id="searchInput" placeholder="Search State or County‚Ä¶" autocomplete="off"/>
        <button id="searchClear" class="search-clear" title="Clear" aria-label="Clear search">√ó</button>
      </div>
      <div id="searchResults" class="search-dropdown"></div>
    </div>

    <h2>Filter Data</h2>

    <!-- Data Layer Selection UI -->
    <div id="layerSelection" style="display:none; margin-bottom:20px;">
      <h3 style="margin:0 0 12px 0; font-size:16px; color:#2d3748; font-weight:600;">üìä Data Visualization</h3>
      <div class="layer-options">
        <button class="layer-btn" data-layer="insurance">
          <span class="layer-icon">üè•</span>
          <span class="layer-title">Insurance Coverage</span>
          <span class="layer-desc">Health insurance rates by location</span>
        </button>
        <button class="layer-btn" data-layer="health">
          <span class="layer-icon">üíä</span>
          <span class="layer-title">Health Outcomes</span>
          <span class="layer-desc">Disease rates and health measures</span>
        </button>
        <button class="layer-btn active" data-layer="combined">
          <span class="layer-icon">üîó</span>
          <span class="layer-title">Combined View</span>
          <span class="layer-desc">Relationship between insurance & health</span>
        </button>
      </div>
    </div>

    <p id="selectPrompt" style="color:#555; font-style:italic; margin-bottom:15px;">
      Please select a geography level to begin.
    </p>

    <label for="levelCat">Geography Level:</label>
    <select id="levelCat">
      <option value="">-- Select Geography Level --</option>
      <option value="county">County</option>
      <option value="state">State</option>
    </select>
    <br/><br/>

    <!-- Hidden until a geography level is selected -->
    <div id="filterOptions" style="display:none;">

      <!-- View mode toggle (only shown for combined view) -->
      <div id="viewModeToggle" style="display:none; margin-bottom:16px;">
        <label style="margin-bottom:8px; display:block; font-weight:600; color:#2d3748;">View Mode:</label>
        <div class="view-mode-buttons">
          <button class="view-btn active" data-view="map">
            <span class="view-icon">üó∫Ô∏è</span>
            <span class="view-text">Map</span>
          </button>
          <button class="view-btn" data-view="scatter">
            <span class="view-icon">üìä</span>
            <span class="view-text">Scatterplot</span>
          </button>
        </div>
      </div>

      <br/><br/>

      <div id="raceWrapper">
        <label>Race Category:</label>
        <select id="raceCat">
          <option value="0">All Races</option>
          <option value="1">White</option>
          <option value="2">Black or African American</option>
          <option value="3">Hispanic or Latino (any race)</option>
          <option value="4">American Indian and Alaska Native</option>
          <option value="5">Asian</option>
          <option value="6">Native Hawaiian and other Pacific Islander</option>
          <option value="7">Two or More Races</option>
        </select>
        <br/><br/>
      </div>

      <label for="ageCat">Age Category:</label>
      <select id="ageCat">
        <option value="0">Under 65 years</option>
        <option value="1">18 to 64</option>
        <option value="2">40 to 64</option>
        <option value="3">50 to 64</option>
        <option value="5">21 to 64 years</option>
      </select>
      <br/><br/>

      <label for="sexCat">Sex Category:</label>
      <select id="sexCat">
        <option value="0">Both Sexes</option>
        <option value="1">Male</option>
        <option value="2">Female</option>
      </select>
      <br/><br/>

      <label for="iprCat">Income Poverty Ratio:</label>
      <select id="iprCat">
        <option value="0">All Incomes</option>
        <option value="1">0-138%</option>
        <option value="2">0-200%</option>
        <option value="3">0-250%</option>
        <option value="4">0-400%</option>
        <option value="5">138-400%</option>
      </select>
      <br/><br/>


      <div id="healthMeasureWrapper" style="display:none;">
        <label for="healthMeasure">Health Measure:</label>
        <select id="healthMeasure">
          <optgroup label="Chronic Diseases">
            <option value="DIABETES">Diabetes</option>
            <option value="OBESITY">Obesity</option>
            <option value="BPHIGH">High Blood Pressure</option>
            <option value="HEART_DISEASE">Coronary Heart Disease</option>
            <option value="STROKE">Stroke</option>
            <option value="CANCER">Cancer (except skin)</option>
            <option value="ASTHMA">Asthma</option>
            <option value="COPD">COPD</option>
            <option value="DEPRESSION">Depression</option>
            <option value="KIDNEY_DISEASE">Chronic Kidney Disease</option>
            <option value="ARTHRITIS">Arthritis</option>
          </optgroup>
          <optgroup label="Prevention">
            <option value="CHECKUP">Annual Checkup</option>
            <option value="CHOLSCREEN">Cholesterol Screening</option>
            <option value="DENTAL">Dental Visit</option>
            <option value="MAMMOUSE">Mammography Use</option>
            <option value="CERVICAL">Cervical Cancer Screening</option>
          </optgroup>
          <optgroup label="Health Behaviors">
            <option value="BINGE">Binge Drinking</option>
            <option value="SMOKING">Current Smoking</option>
            <option value="PHYSICAL_INACTIVITY">Physical Inactivity</option>
            <option value="SLEEP_LESS_7">Sleep &lt; 7 hours</option>
          </optgroup>
        </select>
        <br/><br/>
      </div>

      <!-- Relationship Weight Slider (only shown in combined view) -->
      <!-- Floating Relationship Weight Slider (only shown in combined view) -->
      <div id="relationshipSliderWrapper" class="floating-relationship-slider" style="display:none;">
        <div class="relationship-slider-card">
          <div class="relationship-header">
            <span class="relationship-title">‚öñÔ∏è Relationship Weight</span>
            <span class="relationship-value" id="relationshipValue">50%</span>
          </div>
          <div class="relationship-labels">
            <span class="relationship-label-left">üè• Health Focus</span>
            <span class="relationship-label-right">üí∞ Insurance Focus</span>
          </div>
          <input type="range" id="relationshipSlider" min="0" max="100" value="50" step="1" class="relationship-slider-input"/>
          <div class="relationship-description">
            <span id="sliderDescription">Balanced view: Equal weight to both factors</span>
          </div>
        </div>
      </div>

      <label for="yearSlider">Year: <span id="yearValue">2022</span></label>
      <br/>
      <button id="playButton">‚ñ∂ Play</button>
      <input type="range" id="yearSlider" min="2006" max="2025" value="2022" step="1"/>
      <small style="display: block; font-size: 11px; color: #6b7280; margin-top: 4px;">Note: Data available up to 2022. Slider extends to 2025 for forecasting context.</small>
      <p id="raceNote" style="display:none; font-size:12px; color:#666; margin-top:5px;">
        Note: Some race categories (American Indian, Asian, NHPI, Two or More Races) only have data starting from 2021.
      </p>
    </div> <!-- End filterOptions -->
  </div>

  <!-- Map container (shown in Map view) -->
  <div id="map"></div>

  <!-- Scatterplot container (shown in Scatter view) -->
  <div id="scatterContainer" style="display:none; width:100%; height:520px; position:relative;">
    <div class="scatter-controls">
      <button class="scatter-btn" onclick="resetScatterHighlight()" title="Reset highlighting">Reset Highlight</button>
      <button class="scatter-btn" onclick="resetScatterZoom()" title="Reset zoom">Reset Zoom</button>
    </div>
  </div>
  <div id="scatterTooltip" style="position:absolute; pointer-events:none; padding:8px 12px; background:rgba(255,255,255,0.98); backdrop-filter:blur(8px); border:1px solid rgba(0,0,0,0.1); border-radius:8px; font-size:12px; display:none; box-shadow:0 4px 16px rgba(0,0,0,0.15); max-width:200px; z-index:1000;"></div>

  <div id="gradient-key">
    <h4 id="gradient-title">Insurance Coverage %</h4>
    <div id="insurance-gradient" class="gradient-section">
      <div class="gradient-item"><div class="color-box" style="background-color:#e0f7ff;"></div> &lt; 50%</div>
      <div class="gradient-item"><div class="color-box" style="background-color:#b3e5fc;"></div> 50 - 60%</div>
      <div class="gradient-item"><div class="color-box" style="background-color:#81d4fa;"></div> 60 - 70%</div>
      <div class="gradient-item"><div class="color-box" style="background-color:#1565c0;"></div> 70 - 80%</div>
      <div class="gradient-item"><div class="color-box" style="background-color:#1e3d7b;"></div> 80 - 90%</div>
      <div class="gradient-item"><div class="color-box" style="background-color:#002171;"></div> 90 - 95%</div>
      <div class="gradient-item"><div class="color-box" style="background-color:#000033;"></div> &gt; 95%</div>
    </div>
    <div id="health-gradient" class="gradient-section" style="display:none;">
      <div class="gradient-item"><div class="color-box" style="background-color:#fee5d9;"></div> &lt; 5%</div>
      <div class="gradient-item"><div class="color-box" style="background-color:#fcbba1;"></div> 5 - 10%</div>
      <div class="gradient-item"><div class="color-box" style="background-color:#fc9272;"></div> 10 - 15%</div>
      <div class="gradient-item"><div class="color-box" style="background-color:#fb6a4a;"></div> 15 - 20%</div>
      <div class="gradient-item"><div class="color-box" style="background-color:#ef3b2c;"></div> 20 - 25%</div>
      <div class="gradient-item"><div class="color-box" style="background-color:#cb181d;"></div> 25 - 30%</div>
      <div class="gradient-item"><div class="color-box" style="background-color:#99000d;"></div> &gt; 30%</div>
    </div>
  </div>
  <!-- Floating Analytics Button -->
  <button id="analyticsFAB" class="analytics-fab" title="View Data Analytics">
    <span class="fab-icon">üìä</span>
    <span class="fab-text">Analytics</span>
  </button>

  <!-- Floating Predictive Modeling Button -->
  <button id="predictiveFAB" class="predictive-fab" title="Predictive Modeling">
    <span class="fab-icon">üîÆ</span>
    <span class="fab-text">Predict</span>
  </button>

  <!-- Data Analytics Panel - Slide Out -->
  <div id="analyticsPanel" class="analytics-panel-slide">
    <div class="ap-header">
      <div class="ap-title">üìä Data Analytics</div>
      <div class="ap-header-controls">
        <button id="apMinimize" class="ap-control-btn" title="Minimize">‚àí</button>
        <button id="apClose" class="ap-control-btn" title="Close">√ó</button>
      </div>
    </div>

    <div id="apBody" class="ap-body">
      <!-- Meta badges -->
      <div class="ap-meta">
        <span id="apLayerBadge" class="ap-badge">Layer</span>
        <span id="apScopeBadge" class="ap-badge">Scope</span>
        <span id="apYearBadge" class="ap-badge">Year</span>
        <span id="apMeasureBadge" class="ap-badge" style="display:none;">Measure</span>
      </div>

      <!-- Main content container -->
      <div class="ap-content">
        <!-- Single metric view (Insurance or Health only) -->
        <div id="singleMetricView" class="ap-single-view">
          <div class="ap-stats-section">
            <h3 class="ap-section-header">Statistics</h3>
            <div class="ap-grid">
              <div class="ap-card">
                <div class="ap-label">Count</div>
                <div id="apCount" class="ap-value">‚Äî</div>
                <div class="ap-sub" id="apMissing">Missing: ‚Äî</div>
              </div>
              <div class="ap-card">
                <div class="ap-label">Mean</div>
                <div id="apMean" class="ap-value">‚Äî</div>
                <div class="ap-sub">Std Dev: <span id="apStd">‚Äî</span></div>
              </div>
              <div class="ap-card">
                <div class="ap-label">Median</div>
                <div id="apMedian" class="ap-value">‚Äî</div>
                <div class="ap-sub">IQR: <span id="apQ1">‚Äî</span>-<span id="apQ3">‚Äî</span></div>
              </div>
              <div class="ap-card">
                <div class="ap-label">Range</div>
                <div class="ap-range">
                  <span id="apMin" class="ap-value-small">‚Äî</span>
                  <span class="ap-range-separator">to</span>
                  <span id="apMax" class="ap-value-small">‚Äî</span>
                </div>
              </div>
            </div>
          </div>

          <div class="ap-rankings">
            <div class="ap-list">
              <div class="ap-list-title">üèÜ Top 5 Locations</div>
              <ol id="apTopList" class="ap-ol"></ol>
            </div>
            <div class="ap-list">
              <div class="ap-list-title">üìç Bottom 5 Locations</div>
              <ol id="apBottomList" class="ap-ol"></ol>
            </div>
          </div>
        </div>

        <!-- Combined view (Insurance + Health) -->
        <div id="combinedMetricView" class="ap-combined-view" style="display:none;">
          <!-- Correlation Box -->
          <div id="apCorrBox" class="ap-corr-box">
            <h3 class="ap-section-header">üîó Relationship Analysis</h3>
            <div class="ap-corr-content">
              <div class="ap-corr-item">
                <span class="ap-corr-label">Correlation (r):</span>
                <strong id="apCorr" class="ap-corr-value">‚Äî</strong>
              </div>
              <div class="ap-corr-item">
                <span class="ap-corr-label">Regression:</span>
                <strong id="apReg" class="ap-corr-value">‚Äî</strong>
              </div>
            </div>
          </div>

          <!-- Insurance Stats -->
          <div class="ap-metric-section">
            <h3 class="ap-section-header">üè• Insurance Coverage</h3>
            <div class="ap-grid-compact">
              <div class="ap-card-compact">
                <div class="ap-label">Mean</div>
                <div id="apMeanIns" class="ap-value-compact">‚Äî</div>
              </div>
              <div class="ap-card-compact">
                <div class="ap-label">Median</div>
                <div id="apMedianIns" class="ap-value-compact">‚Äî</div>
              </div>
              <div class="ap-card-compact">
                <div class="ap-label">Std Dev</div>
                <div id="apStdIns" class="ap-value-compact">‚Äî</div>
              </div>
              <div class="ap-card-compact">
                <div class="ap-label">Range</div>
                <div class="ap-value-compact">
                  <span id="apMinIns">‚Äî</span>-<span id="apMaxIns">‚Äî</span>
                </div>
              </div>
            </div>
            <div class="ap-rankings-compact">
              <div class="ap-list-compact">
                <div class="ap-list-title-compact">Top 5</div>
                <ol id="apTopListIns" class="ap-ol-compact"></ol>
              </div>
              <div class="ap-list-compact">
                <div class="ap-list-title-compact">Bottom 5</div>
                <ol id="apBottomListIns" class="ap-ol-compact"></ol>
              </div>
            </div>
          </div>

          <!-- Health Stats -->
          <div class="ap-metric-section">
            <h3 class="ap-section-header">üíä <span id="healthMeasureTitle">Health Measure</span></h3>
            <div class="ap-grid-compact">
              <div class="ap-card-compact">
                <div class="ap-label">Mean</div>
                <div id="apMeanHlth" class="ap-value-compact">‚Äî</div>
              </div>
              <div class="ap-card-compact">
                <div class="ap-label">Median</div>
                <div id="apMedianHlth" class="ap-value-compact">‚Äî</div>
              </div>
              <div class="ap-card-compact">
                <div class="ap-label">Std Dev</div>
                <div id="apStdHlth" class="ap-value-compact">‚Äî</div>
              </div>
              <div class="ap-card-compact">
                <div class="ap-label">Range</div>
                <div class="ap-value-compact">
                  <span id="apMinHlth">‚Äî</span>-<span id="apMaxHlth">‚Äî</span>
                </div>
              </div>
            </div>
            <div class="ap-rankings-compact">
              <div class="ap-list-compact">
                <div class="ap-list-title-compact">Top 5</div>
                <ol id="apTopListHlth" class="ap-ol-compact"></ol>
              </div>
              <div class="ap-list-compact">
                <div class="ap-list-title-compact">Bottom 5</div>
                <ol id="apBottomListHlth" class="ap-ol-compact"></ol>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Predictive Modeling Panel - Slide Out -->
  <div id="predictivePanel" class="predictive-panel-slide">
    <div class="pp-header">
      <div class="pp-title">üîÆ Predictive Modeling</div>
      <div class="pp-header-controls">
        <button id="ppMinimize" class="pp-control-btn" title="Minimize">‚àí</button>
        <button id="ppClose" class="pp-control-btn" title="Close">√ó</button>
      </div>
    </div>

    <div id="ppBody" class="pp-body">
      <!-- Time Series Forecasting Section -->
      <div class="pp-section">
        <h3 class="pp-section-header">‚è±Ô∏è Future Trend Forecasting</h3>
        <p class="pp-section-description">
          Predict future trends based on historical data (2006-2022, forecasting from 2025). Forecast insurance coverage for upcoming years.
        </p>
      </div>

      <!-- Time Series Forecasting Panel -->
      <div class="pp-input-group" id="forecastLocationGroup">
        <label>Location:</label>
        <div style="position: relative;">
          <input type="text" id="forecastLocation" placeholder="Search for state or county..." autocomplete="off">
          <div id="forecastLocationResults" class="search-dropdown" style="display:none;"></div>
        </div>
        <small>Select a state or county to forecast insurance coverage</small>
      </div>

      <div class="pp-input-group">
        <label>Demographics (for insurance forecasting):</label>
        <div class="pp-inputs">
          <select id="forecastTSAge">
            <option value="0">Under 65 years</option>
            <option value="1" selected>18 to 64</option>
            <option value="2">40 to 64</option>
            <option value="3">50 to 64</option>
            <option value="5">21 to 64 years</option>
          </select>
          <select id="forecastTSSex">
            <option value="0" selected>Both Sexes</option>
            <option value="1">Male</option>
            <option value="2">Female</option>
          </select>
          <select id="forecastTSRace">
            <option value="0" selected>All Races</option>
            <option value="1">White</option>
            <option value="2">Black</option>
            <option value="3">Hispanic</option>
            <option value="5">Asian</option>
          </select>
          <select id="forecastTSIncome">
            <option value="0" selected>All Incomes</option>
            <option value="1">0-138% poverty</option>
            <option value="2">0-200% poverty</option>
            <option value="3">0-250% poverty</option>
            <option value="4">0-400% poverty</option>
            <option value="5">138-400% poverty</option>
          </select>
        </div>
      </div>

      <div class="pp-input-group">
        <label>Years to Forecast:</label>
        <input type="range" id="forecastYears" min="1" max="10" value="5" step="1">
        <div class="pp-slider-labels">
          <span>1 year</span>
          <span id="forecastYearsValue" class="pp-slider-value">5 years</span>
          <span>10 years</span>
        </div>
      </div>
      
      <button id="forecastTrendBtn" class="pp-predict-btn">üìà Generate Forecast</button>
      <div id="trendForecastResult" class="pp-result"></div>
      <div id="trendForecastChart" class="pp-chart-container"></div>
    </div>
  </div>

  <!-- Analytics Overlay -->
  <div id="analyticsOverlay" class="analytics-overlay"></div>

  <!-- Predictive Modeling Overlay -->
  <div id="predictiveOverlay" class="predictive-overlay"></div>


  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  
  <!-- Modular JavaScript files -->
  <script src="js/config.js"></script>
  <script src="js/dom-references.js"></script>
  <script src="js/data-manager.js"></script>
  <script src="js/map-manager.js"></script>
  <script src="js/scatterplot-manager.js"></script>
  <script src="js/analytics-manager.js"></script>
  <script src="js/predictive-models.js"></script>
  <script src="js/forecasting-models.js"></script>
  <script src="js/predictive-manager.js"></script>
  <script src="js/ui-controls.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
